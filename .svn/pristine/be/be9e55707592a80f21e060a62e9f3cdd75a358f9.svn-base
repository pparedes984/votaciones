/*
 * File: app/view/wndCandidatoViewController1.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('voto.view.wndCandidatoViewController1', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.wndcandidatom',

    onTxtNombreCMFocusleave: function(component, event, eOpts) {
        Ext.Ajax.request({
            url: '../servidor/voto/candidato/verificar',
            method:"post",
            params: {
                nombre: Ext.getCmp('txtNombreC').getValue(),

            },
            success: function( result, request ) {
                var responseData = Ext.JSON.decode(result.responseText);
                if(responseData.success){
                    Ext.Msg.alert('Error','El candidato ya existe');
                    Ext.getCmp('txtNombreC').setValue('');
                    Ext.getCmp('txtNombreC').reset();
                }

            },

            failure: function(response, opts) {

                console.log('server-side failure with status code ' + response.status);
            }
        });
    },

    onBtnCargarFClick: function(button, e, eOpts) {
        PDF_PATH = '../documentos/voto/';

        x ='';
        var d = new Date();
        var y = d.getFullYear();
        var mo = d.getMonth();
        var da = d.getDate();
        var h = d.getHours();
        var m = d.getMinutes();
        var s = d.getSeconds();

        x = y+""+mo+""+da+""+h+""+m+""+s;

        idEvidencia = x + '.jpg';

        voto.view.Utilidades.loadPDF(idEvidencia, PDF_PATH
        //function(btn) {
        //Ext.getCmp('frmMini').getRecord().set('EVIDENCIA', idEvidencia);
        //}
        );



        URL = '<div style="display: flex; justify-content: center;"><img src="../documentos/voto/';
        URL2 = '../documentos/voto/';
        URL2 = URL2.concat(x);
        URL = URL.concat(idEvidencia);
        URL = URL.concat('" height="124"></div>');
        ventana = 0;
    },

    onCancelButtonClick: function(button, e, eOpts) {
        Ext.getCmp('wndCandidato').close();
    },

    onSaveButtonClick: function(button, e, eOpts) {
        var url = "../documentos/voto/"+x;



        var form = Ext.getCmp('frmCandidatoM').getForm();
        if (form.isValid()) {
            Ext.Ajax.request({
                url: '../servidor/voto/candidato/update',
                method:"post",
                params: {

                    data: Ext.encode(values),

                },
                success: function( result, request ) {

                    var store2 = Ext.getStore('Candidato');
                    Ext.getCmp('wndCandidatoM').close();
                    Ext.Msg.alert('Datos Guardados','Se han guardado los datos exitosamente');
                    store2.removeAll();
                    store2.load();
                },
                failure: function(response, opts) {
                    console.log('server-side failure with status code ' + response.status);
                }
            });
        }


        else
        {
            Ext.Msg.alert('Error','Ingrese los datos correctamente');
        }


    }

});

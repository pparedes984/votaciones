/*
 * File: app/view/vwprtLoginViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('voto.view.vwprtLoginViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.vwprtlogin',

    onTextfieldSpecialkey: function(field, e, eOpts) {
        //asigna la funcion del boton a la tecla ENTER
        if(e.getKey() == e.ENTER)
        {
            this.onButtonClick();
        }
    },

    onButtonClick: function(button, e, eOpts) {
        var forma = this.getView().down('#FormaLogin').getForm();
        if(forma.isValid())
        {
            forma.submit(
            {
                url: '../servidor/login/revisa',
                method: 'post',
                scope: this,
                success: function(response, opts)
                {
                    var responseData = opts.result.data;
                    VERIFIED = responseData.verified;
                    ROL = responseData.rolAp_apps[0].id_rol;
                    if(ROL === null){
                        Ext.Msg.show({
                            title:'Error',
                            msg: 'Usted no tiene permisos para acceder',
                            buttons: Ext.Msg.OK,
                            icon: Ext.MessageBox.WARNING
                        });
                    }
                    else{
                        NOMBRE = responseData.nombre_apps;
                        if(VERIFIED === true && ROL === 1){
                            this.getView().destroy();
                            Ext.create('voto.view.vwprtAdministracion', {renderTo: Ext.getBody()});
                            Ext.getCmp('displayusuario1').setText(NOMBRE);
                        }
                        else if(VERIFIED === true && ROL === 2){
                            this.getView().destroy();
                            Ext.create('voto.view.vwprtLoginVotos', {renderTo: Ext.getBody()});
                            Ext.getCmp('displayusuario').setText('TRIBUNAL: '+NOMBRE);
                        }
                        else{
                            Ext.Msg.show({
                                title:'Error',
                                msg: 'Usted no tiene permisos para acceder',
                                buttons: Ext.Msg.OK,
                                icon: Ext.MessageBox.WARNING
                            });
                        }
                    }
                },

                failure: function(response, opts)
                {
                    Ext.Msg.show({
                        title:'Error',
                        msg: 'Usuario o clave mal ingresados',
                        buttons: Ext.Msg.OK,
                        icon: Ext.MessageBox.WARNING
                    });
                }
            });
        }
        else
        {
            Ext.Msg.alert('Error', 'Debe llenar todos los campos');
        }
    }

});

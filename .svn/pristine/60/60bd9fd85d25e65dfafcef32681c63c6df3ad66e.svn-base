/*
 * File: app/view/wndCandidatoViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('voto.view.wndCandidatoViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.wndcandidato',

    onTxtNombreCFocusleave: function(component, event, eOpts) {
        Ext.Ajax.request({
            url: '../servidor/voto/candidato/verificar',
            method:"post",
            params: {
                nombre: Ext.getCmp('txtNombreC').getValue(),

            },
            success: function( result, request ) {
                var responseData = Ext.JSON.decode(result.responseText);
                if(responseData.success){
                    Ext.Msg.alert('Error','El candidato ya existe');
                    Ext.getCmp('txtNombreC').setValue('');
                    Ext.getCmp('txtNombreC').reset();
                }

            },

            failure: function(response, opts) {

                console.log('server-side failure with status code ' + response.status);
            }
        });
    },

    onBtnCargarIClick: function(button, e, eOpts) {
        /*PDF_PATH = '../documentos/votaciones/';

        x ='';
        var d = new Date();
        var y = d.getFullYear();
        var mo = d.getMonth();
        var da = d.getDate();
        var h = d.getHours();
        var m = d.getMinutes();
        var s = d.getSeconds();

        x = y+""+mo+""+da+""+h+""+m+""+s;

        idEvidencia = x + '.jpg';

        vota_feuce.view.Utilidades.loadPDF(idEvidencia, PDF_PATH
        //function(btn) {
        //Ext.getCmp('frmMini').getRecord().set('EVIDENCIA', idEvidencia);
        //}
        );



        URL = '<div style="display: flex; justify-content: center;"><img src="../documentos/votaciones/';
        URL2 = '../documentos/votaciones/';
        URL2 = URL2.concat(x);
        URL = URL.concat(idEvidencia);
        URL = URL.concat('" height="124"></div>');
        ventana = 0;*/
    },

    onCancelButtonClick: function(button, e, eOpts) {
        Ext.getCmp('wndCandidato').close();
    },

    onSaveButtonClick: function(button, e, eOpts) {
        Ext.Msg.show({
            title: 'Atención',
            msg: 'Esta seguro de crear el candidato. ¿Desea continuar?',
            icon: Ext.Msg.QUESTION,
            buttonText: {
                no: 'No',
                yes: 'Si'
            },
            buttons: Ext.Msg.YESNO,
            fn: function (btn) {
                if (btn == 'yes') {
                    var form = Ext.getCmp('frmCandidato').getForm(),
                        store = Ext.getStore('Candidato');

                    if (form.isValid()) {
                        var values = form.getValues();
                        store.add(values);

                        store.sync(
                        {
                            params:{
                                foto : URL2
                            },
                            success: function(result, options)
                            {
                                Ext.getCmp('wndCandidato').close();
                                Ext.Msg.alert('Datos Guardados','Se han guardado los datos exitosamente');
                                store.removeAll();
                                store.load();
                            },
                            failure: function(batch, options)
                            {

                                Ext.Msg.alert('Error', 'Hubo un error.');
                                store.removeAll();
                            }
                        }
                        );
                    }


                    else
                    {
                        Ext.Msg.alert('Error','Ingrese los datos correctamente');
                    }
                }}
            });



    }

});

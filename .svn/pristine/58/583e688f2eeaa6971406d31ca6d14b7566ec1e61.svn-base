/*
 * File: app/view/vwprtPrincipalViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('voto.view.vwprtPrincipalViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.vwprtprincipal',

    onBtnRegresarClick: function(button, e, eOpts) {
        var indice = Ext.getCmp('dpIndice').getValue();
        if(indice>1){
            Ext.getCmp('btnRegresar').setDisabled(true);
            Ext.getCmp('btnSiguiente').setDisabled(true);
            Ext.getCmp('pnlVotos').removeAll();
            indice--;
            Ext.getCmp('dpIndice').setValue(indice);
            Ext.getCmp('pnlPrincipal').setTitle(TIPOS.data[indice-1].descripcion);
            var panelMenu = Ext.create('Ext.panel.Panel', {
                id:'pnlMenu',
                titleAlign: 'center',
                margin: '10 10 10 10',
                autoScroll: true,
                layout : {
                    type  : 'column'
                },
                renderTo: Ext.getBody()
            });
            Ext.getCmp('pnlVotos').add(panelMenu);
            Ext.Ajax.request({
                url: '../servidor/voto/Candidato/getTipo',
                method:"post",
                params:{
                    tipo: TIPOS.data[indice-1].id,
                },
                success: function( result, request ) {
                    var responseData = Ext.JSON.decode(result.responseText);
                    for(i=0;i<responseData.data.length;i++){
                        var panel = Ext.create('Ext.panel.Panel', {
                            title: responseData.data[i].nombre,
                            titleAlign: 'center',
                            columnWidth: 1/5,
                            margin: '10 10 10 10',
                            layout : {
                                type  : 'vbox',
                                pack  : 'center',
                                align : 'middle'
                            },
                            items: [
                            {
                                xtype: 'panel',
                                layout: 'fit',
                                height: 150,
                                width: 150,
                                margin: '10 0 0 0',
                                html: '<center><img src="../servidor/img/tu-voz-uno.jpg"></center>',
                            },
                            {
                                xtype: 'fieldcontainer',
                                defaultType: 'checkboxfield',
                                items: [
                                {
                                    boxLabel  : 'Votar',
                                    name      : 'votoBinPres',
                                    //checked   : valchb,
                                    inputValue: '1',
                                }
                                ]
                            }
                            ],
                            renderTo: Ext.getBody()
                        });
                        Ext.getCmp('pnlMenu').add(panel);
                    }
                    Ext.getCmp('btnSiguiente').setDisabled(false);
                    if(indice === 1)
                    {
                        Ext.getCmp('btnRegresar').setDisabled(true);
                    }
                    else
                    Ext.getCmp('btnRegresar').setDisabled(false);
                },
                failure: function(response, opts) {
                    console.log('server-side failure with status code ' + response.status);
                }
            });
        }
    },

    onBtnSiguienteClick: function(button, e, eOpts) {
        var indice = Ext.getCmp('dpIndice').getValue();
        if(indice<TIPOS.data.length){
            Ext.getCmp('btnRegresar').setDisabled(true);
            Ext.getCmp('btnSiguiente').setDisabled(true);
            Ext.getCmp('pnlVotos').removeAll();
            indice++;
            Ext.getCmp('dpIndice').setValue(indice);
            Ext.getCmp('pnlPrincipal').setTitle(TIPOS.data[indice-1].descripcion);
            var panelMenu = Ext.create('Ext.panel.Panel', {
                id:'pnlMenu',
                titleAlign: 'center',
                margin: '10 10 10 10',
                autoScroll: true,
                layout : {
                    type  : 'column'
                },
                renderTo: Ext.getBody()
            });
            Ext.getCmp('pnlVotos').add(panelMenu);
            Ext.Ajax.request({
                url: '../servidor/voto/Candidato/getTipo',
                method:"post",
                params:{
                    tipo: TIPOS.data[indice-1].id,
                },
                success: function( result, request ) {
                    var responseData = Ext.JSON.decode(result.responseText);
                    for(i=0;i<responseData.data.length;i++){
                        var panel = Ext.create('Ext.panel.Panel', {
                            title: responseData.data[i].nombre,
                            titleAlign: 'center',
                            columnWidth: 1/5,
                            margin: '10 10 10 10',
                            layout : {
                                type  : 'vbox',
                                pack  : 'center',
                                align : 'middle'
                            },
                            items: [
                            {
                                xtype: 'panel',
                                layout: 'fit',
                                height: 150,
                                width: 150,
                                margin: '10 0 0 0',
                                html: '<center><img src="../servidor/img/tu-voz-uno.jpg"></center>',
                            },
                            {
                                xtype: 'fieldcontainer',
                                defaultType: 'checkboxfield',
                                items: [
                                {
                                    boxLabel  : 'Votar',
                                    name      : 'votoBinPres',
                                    //checked   : valchb,
                                    inputValue: '1',
                                }
                                ]
                            }
                            ],
                            renderTo: Ext.getBody()
                        });
                        Ext.getCmp('pnlMenu').add(panel);
                    }
                    Ext.getCmp('btnSiguiente').setDisabled(false);
                    if(indice === 2)
                    {
                        Ext.getCmp('btnRegresar').setDisabled(false);
                    }
                    else
                    Ext.getCmp('btnRegresar').setDisabled(false);
                },
                failure: function(response, opts) {
                    console.log('server-side failure with status code ' + response.status);
                }
            });
        }
        else{
            var mensaje = "La votación está a punto de finalizar.<br/>"+
            "Usted ha votado por los siguientes candidatos<br/><br/>";
            mensaje = mensaje.concat("<br/>¿Está seguro que desea continuar?");
            Ext.Msg.show({
                title: 'Atención',
                msg: mensaje,
                iconCls:'x-fa fa-info',
                buttonText: {
                    yes: 'Si',
                    no: 'No'
                },
                buttons: Ext.Msg.YESNO,
                fn: function (btn) {
                }
            });
        }
    },

    onPnlVotosRender: function(component, eOpts) {
        Ext.Ajax.request({
            url: '../servidor/voto/Tipocandidato/get',
            method:"post",
            success: function( result, request ) {
                var responseData = Ext.JSON.decode(result.responseText);
                TIPOS = responseData;
                var indice = Ext.getCmp('dpIndice').getValue();
                Ext.getCmp('btnRegresar').setDisabled(true);
                Ext.getCmp('pnlPrincipal').setTitle(TIPOS.data[indice-1].descripcion);
                var panelMenu = Ext.create('Ext.panel.Panel', {
                    id:'pnlMenu',
                    titleAlign: 'center',
                    margin: '10 10 10 10',
                    autoScroll: true,
                    layout : {
                        type  : 'column'
                    },
                    renderTo: Ext.getBody()
                });
                Ext.getCmp('pnlVotos').add(panelMenu);
                Ext.Ajax.request({
                    url: '../servidor/voto/Candidato/getTipo',
                    method:"post",
                    params:{
                        tipo: TIPOS.data[indice-1].id,
                    },
                    success: function( result, request ) {
                        var responseData = Ext.JSON.decode(result.responseText);
                        for(i=0;i<responseData.data.length;i++){
                            var panel = Ext.create('Ext.panel.Panel', {
                                title: responseData.data[i].nombre,
                                titleAlign: 'center',
                                columnWidth: 1/5,
                                margin: '10 10 10 10',
                                layout : {
                                    type  : 'vbox',
                                    pack  : 'center',
                                    align : 'middle'
                                },
                                items: [
                                {
                                    xtype: 'panel',
                                    layout: 'fit',
                                    height: 150,
                                    width: 150,
                                    margin: '10 0 0 0',
                                    html: '<center><img src="../servidor/img/tu-voz-uno.jpg"></center>',
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    defaultType: 'checkboxfield',
                                    items: [
                                    {
                                        boxLabel  : 'Votar',
                                        name      : 'votoBinPres',
                                        //checked   : valchb,
                                        inputValue: '1',
                                    }
                                    ]
                                }
                                ],
                                renderTo: Ext.getBody()
                            });
                            Ext.getCmp('pnlMenu').add(panel);
                        }
                        Ext.getCmp('btnSiguiente').setDisabled(false);
                    },
                    failure: function(response, opts) {
                        console.log('server-side failure with status code ' + response.status);
                    }
                });
            },
            failure: function(response, opts) {
                console.log('server-side failure with status code ' + response.status);
            }
        });
    }

});
